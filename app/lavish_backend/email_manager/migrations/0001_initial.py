# Generated by Django 5.2 on 2025-04-05 07:22

import django.core.validators
import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Device',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('device_id', models.CharField(max_length=100, unique=True)),
                ('operating_system', models.CharField(choices=[('windows', 'Windows'), ('linux', 'Linux'), ('macos', 'macOS')], max_length=10)),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('maintenance', 'Maintenance')], default='active', max_length=20)),
                ('last_seen', models.DateTimeField(auto_now=True)),
                ('security_score', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='DeviceScript',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField()),
                ('operating_system', models.CharField(choices=[('windows', 'Windows'), ('linux', 'Linux'), ('macos', 'macOS')], max_length=10)),
                ('script_content', models.TextField()),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='EmailAutomation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField()),
                ('trigger_type', models.CharField(choices=[('received', 'Email Received'), ('sent', 'Email Sent'), ('attachment', 'Attachment Detected'), ('keyword', 'Keyword Detected'), ('schedule', 'Scheduled')], max_length=20)),
                ('trigger_conditions', models.JSONField(help_text='JSON configuration for trigger conditions')),
                ('action_type', models.CharField(choices=[('forward', 'Forward Email'), ('reply', 'Auto Reply'), ('move', 'Move to Folder'), ('label', 'Apply Label'), ('notify', 'Send Notification'), ('archive', 'Archive Email')], max_length=20)),
                ('action_config', models.JSONField(help_text='JSON configuration for action parameters')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Email Automation',
                'verbose_name_plural': 'Email Automations',
            },
        ),
        migrations.CreateModel(
            name='EmailConfiguration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='A name to identify this email configuration', max_length=100)),
                ('email_host', models.CharField(help_text='SMTP server address (e.g., smtp.gmail.com)', max_length=255)),
                ('email_port', models.PositiveIntegerField(help_text='SMTP server port (e.g., 587 for TLS, 465 for SSL)')),
                ('email_host_user', models.EmailField(help_text='Email address to send from', max_length=254)),
                ('email_host_password', models.CharField(help_text='Password or app password for the email account', max_length=255)),
                ('email_use_tls', models.BooleanField(default=True, help_text='Use TLS encryption')),
                ('email_use_ssl', models.BooleanField(default=False, help_text='Use SSL encryption (do not enable both TLS and SSL)')),
                ('default_from_email', models.EmailField(help_text='Default sender email address (can be same as host user)', max_length=254)),
                ('is_default', models.BooleanField(default=False, help_text='Use this configuration as the default for the site')),
                ('test_email', models.EmailField(blank=True, help_text='Email address to send test emails to', max_length=254, null=True)),
                ('default_template_id', models.IntegerField(blank=True, help_text='Default template ID to use for this config', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Email Config',
                'verbose_name_plural': 'Email Config',
            },
        ),
        migrations.CreateModel(
            name='EmailGuardian',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField()),
                ('is_active', models.BooleanField(default=True)),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], max_length=20)),
                ('rules', models.JSONField(help_text='JSON configuration for security rules')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Email Guardian',
                'verbose_name_plural': 'Email Guardians',
            },
        ),
        migrations.CreateModel(
            name='EmailGuardianRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField()),
                ('severity', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High')], max_length=10)),
                ('pattern', models.TextField(help_text='Regex pattern to match against email content')),
                ('action', models.CharField(choices=[('quarantine', 'Quarantine'), ('delete', 'Delete'), ('mark_spam', 'Mark as Spam'), ('notify', 'Notify Admin')], max_length=50)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name='DeviceScriptExecution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('running', 'Running'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('execution_date', models.DateTimeField(auto_now_add=True)),
                ('completion_date', models.DateTimeField(blank=True, null=True)),
                ('output', models.TextField(blank=True)),
                ('error_message', models.TextField(blank=True)),
                ('device', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.device')),
                ('script', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.devicescript')),
            ],
        ),
        migrations.AddField(
            model_name='device',
            name='installed_scripts',
            field=models.ManyToManyField(through='email_manager.DeviceScriptExecution', to='email_manager.devicescript'),
        ),
        migrations.CreateModel(
            name='EmailFolder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('parent_folder', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='subfolders', to='email_manager.emailfolder')),
            ],
            options={
                'verbose_name': 'Email Folder',
                'verbose_name_plural': 'Email Folders',
            },
        ),
        migrations.CreateModel(
            name='EmailInbox',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('email_address', models.EmailField(max_length=254, unique=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailconfiguration')),
            ],
            options={
                'verbose_name': 'Email Inbox',
                'verbose_name_plural': 'Email Inboxes',
            },
        ),
        migrations.CreateModel(
            name='EmailLabel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('color', models.CharField(max_length=7, validators=[django.core.validators.RegexValidator('^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$')])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Label',
                'verbose_name_plural': 'Email Labels',
            },
        ),
        migrations.CreateModel(
            name='EmailMessage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('subject', models.CharField(max_length=255)),
                ('body', models.TextField()),
                ('html_body', models.TextField(blank=True, null=True)),
                ('from_email', models.EmailField(max_length=254)),
                ('to_emails', models.JSONField()),
                ('cc_emails', models.JSONField(blank=True, default=list)),
                ('bcc_emails', models.JSONField(blank=True, default=list)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('sent', 'Sent'), ('received', 'Received'), ('archived', 'Archived'), ('deleted', 'Deleted')], default='draft', max_length=20)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('normal', 'Normal'), ('high', 'High'), ('urgent', 'Urgent')], default='normal', max_length=20)),
                ('is_favorite', models.BooleanField(default=False)),
                ('is_read', models.BooleanField(default=False)),
                ('is_replied', models.BooleanField(default=False)),
                ('is_forwarded', models.BooleanField(default=False)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('received_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('inbox', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='email_manager.emailinbox')),
                ('parent_message', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='replies', to='email_manager.emailmessage')),
            ],
            options={
                'verbose_name': 'Email Message',
                'verbose_name_plural': 'Email Messages',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(upload_to='email_attachments/')),
                ('filename', models.CharField(max_length=255)),
                ('content_type', models.CharField(max_length=100)),
                ('size', models.PositiveIntegerField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='email_manager.emailmessage')),
            ],
            options={
                'verbose_name': 'Email Attachment',
                'verbose_name_plural': 'Email Attachments',
            },
        ),
        migrations.CreateModel(
            name='EmailScanResult',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scan_date', models.DateTimeField(auto_now_add=True)),
                ('matched_content', models.TextField()),
                ('action_taken', models.CharField(max_length=50)),
                ('details', models.JSONField(default=dict)),
                ('email', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailmessage')),
                ('guardian_rule', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailguardianrule')),
            ],
        ),
        migrations.CreateModel(
            name='EmailTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(help_text='Template name for easy identification', max_length=100)),
                ('template_type', models.CharField(choices=[('contact_form', 'Contact Form Notification'), ('appointment_request', 'Appointment Request'), ('appointment_confirmation', 'Appointment Confirmation'), ('appointment_reminder', 'Appointment Reminder'), ('appointment_cancellation', 'Appointment Cancellation'), ('newsletter', 'Newsletter'), ('welcome', 'Welcome Email'), ('custom', 'Custom Email')], default='custom', max_length=50)),
                ('subject', models.CharField(help_text='Email subject line', max_length=255)),
                ('html_content', models.TextField(help_text='HTML content of the email')),
                ('plain_text_content', models.TextField(help_text='Plain text version of the email')),
                ('variables', models.JSONField(blank=True, default=dict, help_text="List of variables used in the template, with examples. E.g. {'name': 'John', 'date': '2023-01-01'}")),
                ('is_active', models.BooleanField(default=True, help_text='Whether this template is active and can be used')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('configuration', models.ForeignKey(blank=True, help_text='Email configuration to use for sending this template. If blank, default configuration will be used.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='email_manager.emailconfiguration')),
            ],
            options={
                'verbose_name': 'Email Template',
                'verbose_name_plural': 'Email Templates',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='emailmessage',
            name='template',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='email_manager.emailtemplate'),
        ),
        migrations.CreateModel(
            name='MessageLabel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('label', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emaillabel')),
                ('message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailmessage')),
            ],
            options={
                'verbose_name': 'Message Label',
                'verbose_name_plural': 'Message Labels',
            },
        ),
        migrations.CreateModel(
            name='Newsletter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(help_text='Newsletter title', max_length=200)),
                ('subject', models.CharField(help_text='Email subject line', max_length=255)),
                ('html_content', models.TextField(help_text='HTML content of the newsletter')),
                ('plain_text_content', models.TextField(help_text='Plain text version of the newsletter')),
                ('scheduled_time', models.DateTimeField(blank=True, help_text='When to send this newsletter', null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('scheduled', 'Scheduled'), ('sending', 'Sending'), ('sent', 'Sent'), ('cancelled', 'Cancelled')], default='draft', max_length=20)),
                ('sent_time', models.DateTimeField(blank=True, null=True)),
                ('total_recipients', models.PositiveIntegerField(default=0)),
                ('successful_sends', models.PositiveIntegerField(default=0)),
                ('failed_sends', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('configuration', models.ForeignKey(blank=True, help_text='Email configuration to use. If blank, default configuration will be used.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='email_manager.emailconfiguration')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='email_manager_newsletters', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(blank=True, help_text='Template to use for this newsletter (optional)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='newsletters', to='email_manager.emailtemplate')),
            ],
            options={
                'verbose_name': 'Newsletter',
                'verbose_name_plural': 'Newsletters',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='NewsletterSubscriber',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('name', models.CharField(blank=True, max_length=100)),
                ('source', models.CharField(default='website', max_length=50)),
                ('token', models.CharField(blank=True, max_length=100, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('confirmed', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_sent_newsletter', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Newsletter Subscriber',
                'verbose_name_plural': 'Newsletter Subscribers',
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['email'], name='email_manag_email_3159fd_idx'), models.Index(fields=['is_active'], name='email_manag_is_acti_5d62e4_idx'), models.Index(fields=['confirmed'], name='email_manag_confirm_ce5654_idx')],
            },
        ),
        migrations.CreateModel(
            name='ScheduledEmail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('subject_override', models.CharField(blank=True, help_text='Override the template subject (optional)', max_length=255)),
                ('recipients', models.JSONField(help_text='List of email addresses to send to')),
                ('variables_data', models.JSONField(blank=True, default=dict, help_text="Variables to replace in the template. E.g. {'name': 'John', 'date': '2023-01-01'}")),
                ('scheduled_time', models.DateTimeField(help_text='When to send this email')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('sent_time', models.DateTimeField(blank=True, null=True)),
                ('attempts', models.PositiveIntegerField(default=0, help_text='Number of attempts to send this email')),
                ('last_attempt', models.DateTimeField(blank=True, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('configuration', models.ForeignKey(blank=True, help_text="Specific email configuration to use. If blank, the template's configuration or system default will be used.", null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='scheduled_emails', to='email_manager.emailconfiguration')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='email_manager_scheduled_emails', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(help_text='Email template to use', on_delete=django.db.models.deletion.CASCADE, related_name='scheduled_emails', to='email_manager.emailtemplate')),
            ],
            options={
                'verbose_name': 'Scheduled Email',
                'verbose_name_plural': 'Scheduled Emails',
                'ordering': ['-scheduled_time'],
            },
        ),
        migrations.CreateModel(
            name='SecurityAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('alert_type', models.CharField(choices=[('suspicious', 'Suspicious Activity'), ('fraud', 'Potential Fraud'), ('sensitive', 'Sensitive Content'), ('spam', 'Spam Detection'), ('malware', 'Malware Detection')], max_length=20)),
                ('description', models.TextField()),
                ('is_resolved', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('guardian', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailguardian')),
                ('message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='email_manager.emailmessage')),
            ],
            options={
                'verbose_name': 'Security Alert',
                'verbose_name_plural': 'Security Alerts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email_type', models.CharField(choices=[('contact_form', 'Contact Form Notification'), ('appointment_request', 'Appointment Request'), ('appointment_confirmation', 'Appointment Confirmation'), ('appointment_reminder', 'Appointment Reminder'), ('appointment_cancellation', 'Appointment Cancellation'), ('test_email', 'Test Email Configuration'), ('newsletter', 'Newsletter'), ('scheduled_email', 'Scheduled Email'), ('other', 'Other')], max_length=50)),
                ('recipient_email', models.EmailField(max_length=254)),
                ('subject', models.CharField(max_length=255)),
                ('body', models.TextField()),
                ('html_body', models.TextField(blank=True, help_text='HTML version of the email body', null=True)),
                ('sent_at', models.DateTimeField(auto_now_add=True)),
                ('status', models.CharField(choices=[('success', 'Success'), ('failed', 'Failed')], max_length=20)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('object_id', models.PositiveIntegerField(blank=True, null=True)),
                ('content_type', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='email_manager_history', to='contenttypes.contenttype')),
            ],
            options={
                'verbose_name': 'Email History',
                'verbose_name_plural': 'Email History',
                'ordering': ['-sent_at'],
                'indexes': [models.Index(fields=['email_type'], name='email_manag_email_t_66932e_idx'), models.Index(fields=['sent_at'], name='email_manag_sent_at_6af156_idx'), models.Index(fields=['recipient_email'], name='email_manag_recipie_23d477_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='emailmessage',
            index=models.Index(fields=['status'], name='email_manag_status_67cdf6_idx'),
        ),
        migrations.AddIndex(
            model_name='emailmessage',
            index=models.Index(fields=['is_read'], name='email_manag_is_read_ec7ba0_idx'),
        ),
        migrations.AddIndex(
            model_name='emailmessage',
            index=models.Index(fields=['is_favorite'], name='email_manag_is_favo_533fc6_idx'),
        ),
        migrations.AddIndex(
            model_name='emailmessage',
            index=models.Index(fields=['created_at'], name='email_manag_created_90250e_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='messagelabel',
            unique_together={('message', 'label')},
        ),
        migrations.AddIndex(
            model_name='scheduledemail',
            index=models.Index(fields=['status'], name='email_manag_status_98dfd1_idx'),
        ),
        migrations.AddIndex(
            model_name='scheduledemail',
            index=models.Index(fields=['scheduled_time'], name='email_manag_schedul_8ada71_idx'),
        ),
    ]
